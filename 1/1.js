/*
BitmapData for EaselJS
Version: 0.82
Author: kudox
http://kudox.jp/
http://twitter.com/u_kudox
Licensed under the MIT License
Copyright (c) 2013 kudox.jp
*/
this.createjs=this.createjs||{};(function(G){function BitmapData(a,b,c,d){b=b>>0||a.width||300;c=c>>0||a.height||150;var e=this.canvas=createCanvas(b,c);var f=this.context=e.getContext("2d");if(!!a)f.drawImage(a,0,0);if(d!==undefined)this.fillRect(new createjs.Rectangle(0,0,b,c),d);if(!this._imageData)this._imageData=f.getImageData(0,0,b,c)}BitmapData.VERSION="0.8.2";BitmapData.getBitmapData=function(a){var b,cvs;if(a instanceof createjs.DisplayObject){if(!!a.cacheCanvas){b=Object.create(BitmapData.prototype);cvs=b.canvas=a.cacheCanvas}else{throw new Error("The object must be called DisplayObject.cache().");}}else{return}var c=b.context=cvs.getContext("2d");b._imageData=c.getImageData(0,0,cvs.width,cvs.height);return b};var p=BitmapData.prototype={get width(){return this.canvas.width},get height(){return this.canvas.height},get rect(){return new createjs.Rectangle(0,0,this.canvas.width,this.canvas.height)}};p.constructor=BitmapData;p.canvas=null;p.context=null;p.name=null;p._imageData=null;p._contextChanged=false;p.clearRect=function(x,y,a,b){this.context.clearRect(x,y,a,b);this._contextChanged=true};p.clone=function(){var a=Object.create(BitmapData.prototype);var w=this.width;var h=this.height;var b=a.canvas=createCanvas(w,h);var c=a.context=b.getContext("2d");if(this._contextChanged)this.updateImageData();c.putImageData(this._imageData,0,0);a._imageData=c.getImageData(0,0,w,h);return a};p.colorTransform=function(c,d){var x=c.x>>0;var y=c.y>>0;var w=c.width>>0;var h=c.height>>0;var e=this.context;var f=e.getImageData(x,y,w,h);var j=f.data;for(var i=0,l=j.length;i<l;i+=4){var r=i;var g=i+1;var b=i+2;var a=i+3;j[r]=j[r]*d.redMultiplier+d.redOffset;j[g]=j[g]*d.greenMultiplier+d.greenOffset;j[b]=j[b]*d.blueMultiplier+d.blueOffset;j[a]=j[a]*d.alphaMultiplier+d.alphaOffset}e.putImageData(f,x,y);this._contextChanged=true};p.compare=function(c){var w=c.width;var h=c.height;if(this.width!==w){return-3}else if(this.height!==h){return-4}var d=getSourceContext(c,w,h);var e=d.getImageData(0,0,w,h);var f=e.data;if(this._contextChanged)this.updateImageData();var j=this._imageData;var k=j.data;if(Array.prototype.slice.call(k).toString()===Array.prototype.slice.call(f).toString()){return 0}var m=Object.create(BitmapData.prototype);var n=m.canvas=createCanvas(w,h);var o=m.context=n.getContext("2d");var p=m._imageData=o.createImageData(w,h);var q=p.data;for(var i=0,l=k.length;i<l;i+=4){var r=i;var g=i+1;var b=i+2;var a=i+3;var s=(k[r]===f[r])&&(k[g]===f[g])&&(k[b]===f[b]);var t=k[a]===f[a];if(!s){q[r]=(k[r]-f[r])&0xFF;q[g]=(k[g]-f[g])&0xFF;q[b]=(k[b]-f[b])&0xFF;q[a]=255}else if(!t){q[r]=q[g]=q[b]=255;q[a]=k[a]-f[a]}}o.putImageData(p,0,0);return m};p.copyChannel=function(a,b,c,d,e){var f=b.x>>0;var g=b.y>>0;var h=b.width>>0;var j=b.height>>0;var k=c.x>>0;var m=c.y>>0;var n=getSourceContext(a,f+h,g+j);var o=n.getImageData(f,g,h,j);var p=o.data;var q=H.getChannelIndex(d);var r=this.context;var s=r.getImageData(k,m,h,j);var t=s.data;var u=H.getChannelIndex(e);for(var i=0,l=t.length;i<l;i+=4){t[i+u]=p[i+q]}r.putImageData(s,k,m);this._contextChanged=true};p.copyPixels=function(a,b,c,d,e,f){var g=b.x>>0;var h=b.y>>0;var j=b.width>>0;var k=b.height>>0;var m=c.x>>0;var n=c.y>>0;var o=getSourceContext(a,g+j,h+k);var p=o.getImageData(g,h,j,k);if(!!d){var q,ay;if(e){q=e.x>>0;ay=e.y>>0}else{q=g;ay=h}var r=getSourceContext(d,q+j,ay+k);var s=r.getImageData(q,ay,j,k);var t=p.data;var u=s.data;for(var i=3,l=t.length;i<l;i+=4){t[i]=u[i]}if(f){o.putImageData(p,g,h);this.context.drawImage(o.canvas,g,h,j,k,m,n,j,k)}else{this.context.putImageData(p,m,n)}}else{this.context.putImageData(p,m,n)}this._contextChanged=true};p.dispose=function(){delete this._imageData;delete this.context;delete this.canvas};p.draw=function(a,b,c,d,e,f){if(a instanceof BitmapData||a instanceof createjs.Stage){a=a.canvas}else if(a instanceof createjs.DisplayObject){if(!!a.cacheCanvas){a=a.cacheCanvas}else{throw new Error("The source of BitmapData.draw(), must be called DisplayObject.cache().");}}b=b||new createjs.Matrix2D();var g;if(!!c){var h=a.width;var i=a.height;g=new BitmapData(a,h,i);g.colorTransform(new createjs.Rectangle(0,0,h,i),c);a=g.canvas}f=!!f;var j=this.context;j.save();if(!!d)j.globalCompositeOperation=d;j.imageSmoothingEnabled=f;j.webkitImageSmoothingEnabled=f;j.mozImageSmoothingEnabled=f;if(!!e){j.rect(e.x,e.y,e.width,e.height);j.clip()}j.setTransform(b.a,b.b,b.c,b.d,b.tx,b.ty);j.drawImage(a,0,0);j.restore();if(!!g){g.dispose()}this._contextChanged=true};p.drawImage=function(a,b,c,d,e,f,g,h,i){if(a instanceof BitmapData||a instanceof createjs.Stage){a=a.canvas}else if(a instanceof createjs.DisplayObject){if(!!a.cacheCanvas){a=a.cacheCanvas}else{throw new Error("The source of BitmapData.drawImage(), must be called DisplayObject.cache().");}}if(f!==undefined){this.context.drawImage(a,b,c,d,e,f,g,h,i)}else if(d!==undefined){f=b;g=c;h=d;i=e;this.context.drawImage(a,f,g,h,i)}else{f=b||0;g=c||0;this.context.drawImage(a,f,g)}this._contextChanged=true};p.fillRect=function(c,d){if(!isNaN(d)){var r=d>>16&0xFF;var g=d>>8&0xFF;var b=d&0xFF;var a=(d>>24&0xFF)/255;if(a===0){d="rgb("+r+","+g+","+b+")"}else{d="rgba("+r+","+g+","+b+","+a+")"}}var e=this.context;e.save();e.fillStyle=d;e.fillRect(c.x,c.y,c.width,c.height);e.restore();this._contextChanged=true};p.floodFill=function(x,y,a){if(this._contextChanged)this.updateImageData();var b=this._imageData;var w=b.width;var h=b.height;x=x>>0;y=y>>0;if(x<0||y<0||w<=x||h<=y){return}var c=this.getPixel32(x,y);if(c===a){return}var d=b.data;var e=[new createjs.Point(x,y)];while(e.length){var p=e.shift();var f=p.x;var g=p.y;if(this.getPixel32(f,g)===a){continue}for(var j=f;0<j;j--){if(this.getPixel32(j-1,g)!==c){break}}for(var k=f;k<w-1;k++){if(this.getPixel32(k+1,g)!==c){break}}for(var i=j;i<=k;i++){this.setPixel32(i,g,a)}if(g+1<h)scanLine.call(this,j,k,g+1,c,e);if(0<=g-1)scanLine.call(this,j,k,g-1,c,e)}this.updateContext()};p.getColorBoundsRect=function(a,b,c){if(c===undefined)c=true;if(this._contextChanged)this.updateImageData();var e=this._imageData;var w=e.width;var h=e.height;var d=e.data;var f=NaN,xMax=NaN,yMin=NaN,yMax=NaN;for(var i=0,l=d.length;i<l;i+=4){var g=((d[i+3]<<24|d[i]<<16|d[i+1]<<8|d[i+2])&a)>>>0;if((c&&(g===b))||(!c&&(g!==b))){var p=i/4;var x=p%w;var y=p/w>>0;if(isNaN(f)){f=xMax=x;yMin=yMax=y}else{if(x<f)f=x;if(xMax<x)xMax=x;if(y<yMin)yMin=y;if(yMax<y)yMax=y}}if(f===0&&xMax===w-1&&yMin===0&&yMax===h-1){break}}if(isNaN(f)){return new createjs.Rectangle()}else{return new createjs.Rectangle(f,yMin,xMax-f+1,yMax-yMin+1)}};p.getPixel=function(x,y){x=x>>0;y=y>>0;if(this._contextChanged)this.updateImageData();var a=this._imageData;var w=a.width;var h=a.height;if(w<=x||h<=y){return 0}var d=a.data;var i=((w*y)+x)*4;var r=d[i];var g=d[++i];var b=d[++i];return r<<16|g<<8|b};p.getPixel32=function(x,y){x=x>>0;y=y>>0;if(this._contextChanged)this.updateImageData();var c=this._imageData;var w=c.width;var h=c.height;if(w<=x||h<=y){return 0}var d=c.data;var i=((w*y)+x)*4;var r=d[i];var g=d[++i];var b=d[++i];var a=d[++i];return(a<<24|r<<16|g<<8|b)>>>0};p.getPixels=function(a){return this.context.getImageData(a.x>>0,a.y>>0,a.width>>0,a.height>>0).data};p.histogram=function(a){var h=[[],[],[],[]];for(var i=0,l=256;i<l;i++){h[0][i]=0;h[1][i]=0;h[2][i]=0;h[3][i]=0}var b=this.context.getImageData(a.x>>0,a.y>>0,a.width>>0,a.height>>0);var d=b.data;for(i=0,l=d.length;i<l;i+=4){h[0][d[i]]++;h[1][d[i+1]]++;h[2][d[i+2]]++;h[3][d[i+3]]++}return h};p.hitTest=function(a,b,c,d,e){b=b||1;var f=a.x>>0;var g=a.y>>0;var w=this.width;var h=this.height;if(this._contextChanged)this.updateImageData();var i=this._imageData.data;var j,sy;if(c instanceof createjs.Point){j=(c.x>>0)-f;sy=(c.y>>0)-g;if(w<=j||h<=sy||j<0||sy<0){return false}return b<=i[((w*sy)+j)*4+3]}var k,ax,ay,aw,ah;if(c instanceof createjs.Rectangle){c.x=(c.x>>0)-f;c.y=(c.y>>0)-g;k=getIntersection(new createjs.Rectangle(0,0,w,h),c);if(k===0){return false}for(ay=k.y,ah=ay+k.height;ay<ah;ay++){for(ax=k.x,aw=ax+k.width;ax<aw;ax++){if(b<=i[((w*ay)+ax)*4+3]){return true}}}return false}var l=getSourceContext(c,c.width,c.height);if(!l){throw new Error("The secondObject must be Point, Rectangle, BitmapData, cached DisplayObject.");}d=d||new createjs.Point();e=e||1;j=(d.x>>0)-f;sy=(d.y>>0)-g;var m=l.canvas;k=getIntersection(new createjs.Rectangle(0,0,w,h),new createjs.Rectangle(j,sy,m.width,m.height));if(k===0){return false}var n=k.x;var o=k.y;var p=k.width;var q=k.height;var r=l.getImageData(n-j,o-sy,p,q);var s=r.data;for(ay=o,ah=ay+q;ay<ah;ay++){for(ax=n,aw=ax+p;ax<aw;ax++){if(e<=s[((p*(ay-o))+(ax-n))*4+3]){if(b<=i[((w*ay)+ax)*4+3]){return true}}}}return false};p.merge=function(c,d,e,f,h,j,k){var m=d.x>>0;var n=d.y>>0;var o=d.width>>0;var p=d.height>>0;var q=e.x>>0;var s=e.y>>0;var t=getSourceContext(c,m+o,n+p);var u=t.getImageData(m,n,o,p);var v=u.data;var w=this.context;var x=w.getImageData(q,s,o,p);var y=x.data;for(var i=0,l=y.length;i<l;i+=4){var r=i;var g=i+1;var b=i+2;var a=i+3;y[r]=((v[r]*f)+(y[r]*(256-f)))/256;y[g]=((v[g]*h)+(y[g]*(256-h)))/256;y[b]=((v[b]*j)+(y[b]*(256-j)))/256;y[a]=((v[a]*k)+(y[a]*(256-k)))/256}w.putImageData(x,q,s);this._contextChanged=true};p.noise=function(c,e,f,h){c=c||0;e=e||255;var j=e-c;f=f||7;h=!!h;var k=Object.create(H);var m=(f&k.RED)===k.RED;var n=(f&k.GREEN)===k.GREEN;var o=(f&k.BLUE)===k.BLUE;var p=(f&k.ALPHA)===k.ALPHA;var d=this._imageData.data;for(var i=0,l=d.length;i<l;i+=4){var r=i;var g=i+1;var b=i+2;var a=i+3;if(h){d[r]=d[g]=d[b]=(Math.random()*j>>0)+c}else{d[r]=(m)?(Math.random()*j>>0)+c:0;d[g]=(n)?(Math.random()*j>>0)+c:0;d[b]=(o)?(Math.random()*j>>0)+c:0}d[a]=(p)?(Math.random()*j>>0)+c:255}this.updateContext()};p.paletteMap=function(c,d,e,f,h,j,k){var m=d.x>>0;var n=d.y>>0;var o=d.width>>0;var p=d.height>>0;var q=e.x>>0;var s=e.y>>0;var t=getSourceContext(c,m+o,n+p);var u=t.getImageData(m,n,o,p);var v=u.data;var w=this.context;var x=w.getImageData(q,s,o,p);var y=x.data;for(var i=0,l=y.length;i<l;i+=4){var r=i;var g=i+1;var b=i+2;var a=i+3;var z=(f)?f[v[r]]:v[r]<<16;var A=(h)?h[v[g]]:v[g]<<8;var B=(j)?j[v[b]]:v[b];var C=(k)?k[v[a]]:(v[a]<<24)>>>0;y[r]=((z>>16&0xFF)+(A>>16&0xFF)+(B>>16&0xFF)+(C>>16&0xFF))%256;y[g]=((z>>8&0xFF)+(A>>8&0xFF)+(B>>8&0xFF)+(C>>8&0xFF))%256;y[b]=((z&0xFF)+(A&0xFF)+(B&0xFF)+(C&0xFF))%256;y[a]=((z>>24&0xFF)+(A>>24&0xFF)+(B>>24&0xFF)+(C>>24&0xFF))%256}w.putImageData(x,q,s);this._contextChanged=true};p.pixelDissolve=function(a,b,c,d,e,f){var w=this.width;var h=this.height;var g=b.x>>0;var i=b.y>>0;var j=b.width>>0;var k=b.height>>0;var l=c.x>>0;var m=c.y>>0;e=e||j*k/30>>0;var n=this===a;var o,green,blue,alpha;if(n&&f!==undefined){o=f>>16&0xFF;green=f>>8&0xFF;blue=f&0xFF;alpha=f>>24&0xFF}var q=getSourceContext(a,g+j,i+k);var r=q.getImageData(g,i,j,k);var s=r.data;if(this._contextChanged)this.updateImageData();var t=this._imageData.data;if(!d){d=[];for(var y=0;y<k;y++){for(var x=0;x<j;x++){d.push(new createjs.Point(x,y))}}}while(0<e){var u=Math.random()*(d.length-1)>>0;var p=d.splice(u,1)[0];var v=p.x;var z=p.y;var A=v+l;var B=z+m;if(A<0||B<0||w<=A||h<=B){continue}var C=((w*B)+A)*4;if(n){t[C]=o;t[++C]=green;t[++C]=blue;t[++C]=alpha}else{var D=((j*z)+v)*4;t[C]=s[D];t[++C]=s[++D];t[++C]=s[++D];t[++C]=s[++D]}if(d.length===0){this.updateContext();return 0}e--}this.updateContext();return d};p.scroll=function(x,y){var a=this.context;if(this._contextChanged)this.updateImageData();a.putImageData(this._imageData,x>>0,y>>0);this._contextChanged=true};p.setPixel=function(x,y,a){x=x>>0;y=y>>0;if(this._contextChanged)this.updateImageData();var b=this._imageData;var w=b.width;var h=b.height;if(w<=x||h<=y){return}var d=b.data;var i=((w*y)+x)*4;d[i]=a>>16&0xFF;d[++i]=a>>8&0xFF;d[++i]=a&0xFF};p.setPixel32=function(x,y,a){x=x>>0;y=y>>0;if(this._contextChanged)this.updateImageData();var b=this._imageData;var w=b.width;var h=b.height;if(w<=x||h<=y){return}var d=b.data;var i=((w*y)+x)*4;d[i]=a>>16&0xFF;d[++i]=a>>8&0xFF;d[++i]=a&0xFF;d[++i]=a>>24&0xFF};p.setPixels=function(a,b){var c=this.context;var d=c.createImageData(a.width>>0,a.height>>0);var e=d.data;for(var i=0,l=e.length;i<l;i++){e[i]=b[i]}c.putImageData(d,a.x>>0,a.y>>0);this._contextChanged=true};p.threshold=function(c,d,e,f,h,j,k,m){var n=d.x>>0;var o=d.y>>0;var p=d.width>>0;var q=d.height>>0;var s=e.x>>0;var t=e.y>>0;var u=getThresholdMethod(f);j=j||0;var v=j>>16&0xFF;var w=j>>8&0xFF;var x=j&0xFF;var y=j>>24&0xFF;if(k===undefined)k=0xFFFFFFFF;var z=getSourceContext(c,n+p,o+q);var A=z.getImageData(n,o,p,q);var B=A.data;var C=this.context;var D=C.getImageData(s,t,p,q);var E=D.data;for(var i=0,l=E.length;i<l;i+=4){var r=i;var g=i+1;var b=i+2;var a=i+3;var F=(B[a]<<24|B[r]<<16|B[g]<<8|B[b])>>>0;if(u(F&k,h&k)){E[r]=v;E[g]=w;E[b]=x;E[a]=y}else if(m){E[r]=B[r];E[g]=B[g];E[b]=B[b];E[a]=B[a]}}C.putImageData(D,s,t);this._contextChanged=true};p.toString=function(){return"[BitmapData (name="+this.name+")]"};p.updateContext=function(){this.context.putImageData(this._imageData,0,0)};p.updateImageData=function(){this._imageData=this.context.getImageData(0,0,this.width,this.height);this._contextChanged=false};function createCanvas(a,b){var c=document.createElement("canvas");c.width=a;c.height=b;return c}function getIntersection(a,c){var d=a.width;var e=a.height;var f=c.width;var g=c.height;if(d===0||e===0||f===0||g===0){return 0}var h=a.x;var i=h+d;var j=a.y;var k=j+e;var m=c.x;var n=m+f;var o=c.y;var p=o+g;if(h<n&&j<p&&m<i&&o<k){var l=(h<m)?m:h;var r=(n<i)?n:i;var t=(j<o)?o:j;var b=(p<k)?p:k;return new createjs.Rectangle(l,t,r-l,b-t)}else{return 0}}function getSourceContext(a,b,c){var d;if(a instanceof BitmapData){d=a.context}else if(a instanceof HTMLCanvasElement){d=a.getContext("2d")}else if(a instanceof createjs.Stage){d=a.canvas.getContext("2d")}else if(a instanceof createjs.DisplayObject){if(!!a.cacheCanvas){d=a.cacheCanvas.getContext("2d")}else{throw new Error("The source must be called DisplayObject.cache().");}}else if(a instanceof HTMLImageElement||a instanceof HTMLVideoElement){var e=createCanvas(b,c);d=e.getContext("2d");d.drawImage(a,0,0)}return d}function getThresholdMethod(c){switch(c){case"<":return function(a,b){return a<b};case"<=":return function(a,b){return a<=b};case">":return function(a,b){return a>b};case">=":return function(a,b){return a>=b};case"==":return function(a,b){return a==b};case"!=":return function(a,b){return a!=b}}}function scanLine(a,b,y,c,d){while(a<=b){while(a<=b){if(this.getPixel32(a,y)===c){break}a++}if(b<a){break}a++;while(a<=b){if(this.getPixel32(a,y)!==c){break}a++}d.push(new createjs.Point(a-1,y))}}var H={ALPHA:8,BLUE:4,GREEN:2,RED:1,getChannelIndex:function(a){switch(a){case H.RED:return 0;case H.GREEN:return 1;case H.BLUE:return 2;case H.ALPHA:return 3}}};var I=(function(){function I(a,b,c,d,e,f,g,h){if(a!==undefined)this.redMultiplier=a;if(b!==undefined)this.greenMultiplier=b;if(c!==undefined)this.blueMultiplier=c;if(d!==undefined)this.alphaMultiplier=d;if(e!==undefined)this.redOffset=e;if(f!==undefined)this.greenOffset=f;if(g!==undefined)this.blueOffset=g;if(h!==undefined)this.alphaOffset=h}var p=I.prototype={get color(){return(this.redOffset<<16|this.greenOffset<<8|this.blueOffset)>>>0},set color(value){this.redMultiplier=this.greenMultiplier=this.blueMultiplier=0;this.redOffset=value>>16&0xFF;this.greenOffset=value>>8&0xFF;this.blueOffset=value&0xFF}};p.constructor=I;p.redMultiplier=1;p.greenMultiplier=1;p.blueMultiplier=1;p.alphaMultiplier=1;p.redOffset=0;p.greenOffset=0;p.blueOffset=0;p.alphaOffset=0;p.clone=function(){var a=Object.create(I.prototype);if(this.hasOwnProperty("redMultiplier"))a.redMultiplier=this.redMultiplier;if(this.hasOwnProperty("greenMultiplier"))a.greenMultiplier=this.greenMultiplier;if(this.hasOwnProperty("blueMultiplier"))a.blueMultiplier=this.blueMultiplier;if(this.hasOwnProperty("alphaMultiplier"))a.alphaMultiplier=this.alphaMultiplier;if(this.hasOwnProperty("redOffset"))a.redOffset=this.redOffset;if(this.hasOwnProperty("greenOffset"))a.redOffset=this.redOffset;if(this.hasOwnProperty("blueOffset"))a.redOffset=this.redOffset;if(this.hasOwnProperty("alphaOffset"))a.redOffset=this.redOffset;return a};p.concat=function(a){this.redOffset+=this.redMultiplier*a.redOffset;this.greenOffset+=this.greenMultiplier*a.greenOffset;this.blueOffset+=this.blueMultiplier*a.blueOffset;this.alphaOffset+=this.alphaMultiplier*a.alphaOffset;this.redMultiplier*=a.redMultiplier;this.greenMultiplier*=a.greenMultiplier;this.blueMultiplier*=a.blueMultiplier;this.alphaMultiplier*=a.alphaMultiplier};p.toString=function(){return"[ColorTransform (redMultiplier="+this.redMultiplier+", greenMultiplier="+this.greenMultiplier+", blueMultiplier="+this.blueMultiplier+", alphaMultiplier="+this.alphaMultiplier+", redOffset="+this.redOffset+", greenOffset="+this.greenOffset+", blueOffset="+this.blueOffset+", alphaOffset="+this.alphaOffset+")]"};return I}());createjs.BitmapData=BitmapData;createjs.BitmapDataChannel=H;createjs.ColorTransform=I}(window));